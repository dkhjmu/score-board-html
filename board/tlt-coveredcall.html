<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¯¸êµ­ì±„ 30ë…„ë¬¼ ì»¤ë²„ë“œì½œ ìˆ˜ìµ êµ¬ì¡° ì‹œë®¬ë ˆì´í„°</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --primary: #0f172a;
            --accent: #3b82f6;
        }
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg-color);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #333;
        }
        .container {
            max-width: 900px;
            width: 100%;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        h1 { margin-top: 0; font-size: 1.5rem; text-align: center; }
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
            padding: 20px;
            background: #f1f5f9;
            border-radius: 12px;
        }
        .control-group { display: flex; flex-direction: column; gap: 10px; }
        label { font-weight: 600; font-size: 0.9rem; }

        /* ìŠ¬ë¼ì´ë” ìŠ¤íƒ€ì¼ */
        input[type=range] {
            width: 100%;
            cursor: pointer;
        }
        .value-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent);
        }

        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
            margin-top: 20px;
        }

        .summary-box {
            margin-top: 20px;
            padding: 15px;
            border-left: 4px solid var(--accent);
            background: #eff6ff;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        .highlight-red { color: #ef4444; font-weight: bold; }
        .highlight-blue { color: #3b82f6; font-weight: bold; }

        @media (max-width: 600px) {
            .controls { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ‡ºğŸ‡¸ ë¯¸êµ­ì±„ 30ë…„ë¬¼ ì»¤ë²„ë“œì½œ(Covered Call) ì „ëµ ì‹œë®¬ë ˆì´í„°</h1>
    <p style="text-align: center; color: #64748b; font-size: 0.9rem;">
        ê¸ˆë¦¬ ë³€í™”ì— ë”°ë¥¸ ì±„ê¶Œ ê°€ê²© ë³€ë™ê³¼ ì˜µì…˜ í”„ë¦¬ë¯¸ì—„ ìˆ˜ìµì˜ ê´€ê³„ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.
    </p>

    <div class="controls">
        <div class="control-group">
            <label>ğŸ·ï¸ ì»¤ë²„ë“œì½œ ë§¤ë„ ë¹„ì¤‘ (Hedge Ratio)</label>
            <div class="value-display"><span id="ccPercentVal">50</span>%</div>
            <input type="range" id="ccSlider" min="0" max="100" step="10" value="50">
            <small style="color:#666;">0%: ì±„ê¶Œë§Œ ë³´ìœ (ê³µê²©ì ) <br> 100%: ì™„ì „ ë°©ì–´í˜•(JEPI/TLTW ë“±)</small>
        </div>

        <div class="control-group">
            <label>ğŸ’° ì—°ê°„ ì˜µì…˜ í”„ë¦¬ë¯¸ì—„ ìˆ˜ìµë¥  (Premium)</label>
            <div class="value-display"><span id="premiumVal">12</span>%</div>
            <input type="range" id="premiumSlider" min="4" max="20" step="1" value="12">
            <small style="color:#666;">ë³€ë™ì„±ì´ í´ìˆ˜ë¡ í”„ë¦¬ë¯¸ì—„ì´ ë†’ìŒ (ë³´í†µ 8~15%)</small>
        </div>
    </div>

    <div class="chart-container">
        <canvas id="payoffChart"></canvas>
    </div>

    <div class="summary-box" id="analysisText">
    </div>
</div>

<script>
    // --- ìƒìˆ˜ ë° ì„¤ì • ---
    // ë¯¸êµ­ì±„ 30ë…„ë¬¼ ê°€ì •: ë“€ë ˆì´ì…˜ ì•½ 17ë…„ (ê¸ˆë¦¬ 1% ë³€ë™ ì‹œ ê°€ê²© 17% ë³€ë™)
    const DURATION = 17;
    const BOND_COUPON = 4.0; // ì±„ê¶Œ ìì²´ ì´ì (ì—° 4% ê°€ì •)

    const ctx = document.getElementById('payoffChart').getContext('2d');
    const ccSlider = document.getElementById('ccSlider');
    const premiumSlider = document.getElementById('premiumSlider');
    const ccDisplay = document.getElementById('ccPercentVal');
    const premiumDisplay = document.getElementById('premiumVal');
    const analysisText = document.getElementById('analysisText');

    let myChart;

    // --- ë°ì´í„° ê³„ì‚° ë¡œì§ ---
    function calculateData(ccRatio, annualPremium) {
        const labels = [];
        const bondOnlyData = [];
        const strategyData = [];

        // Xì¶•: ê¸ˆë¦¬ ë³€í™” (-2.0% ~ +2.0%)
        for (let rateChange = -2.0; rateChange <= 2.0; rateChange += 0.2) {
            const rateChangeFixed = parseFloat(rateChange.toFixed(1));
            labels.push(`${rateChangeFixed > 0 ? '+' : ''}${rateChangeFixed}%`);

            // 1. ì±„ê¶Œ ê°€ê²© ë³€ë™ (Duration íš¨ê³¼)
            // ê¸ˆë¦¬ ìƒìŠ¹ -> ê°€ê²© í•˜ë½ ( -Duration * rateChange )
            const priceChange = -DURATION * rateChangeFixed;

            // 2. ìˆœìˆ˜ ì±„ê¶Œ ë³´ìœ  ì´ ìˆ˜ìµ (ê°€ê²©ë³€ë™ + ì±„ê¶Œì´ì)
            const rawBondReturn = priceChange + BOND_COUPON;

            // 3. ì»¤ë²„ë“œì½œ ì˜µì…˜ ì†ìµ êµ¬ì¡° (ë‹¨ìˆœí™” ëª¨ë¸)
            // ì˜µì…˜ ë§¤ë„ë¶„: ì±„ê¶Œ ê°€ê²©ì´ ìƒìŠ¹í•˜ë©´(ê¸ˆë¦¬ í•˜ë½) ìƒìŠ¹ë¶„ í¬ê¸°(Cap), í•˜ë½í•˜ë©´ í”„ë¦¬ë¯¸ì—„ ë°©ì–´
            // ìƒìŠ¹ì¥(ê¸ˆë¦¬ì¸í•˜): ì˜µì…˜ í–‰ì‚¬ë¨ -> ìë³¸ì´ë“ ì œí•œ (ì˜µì…˜ í”„ë¦¬ë¯¸ì—„ë§Œ ë¨¹ìŒ)
            // í•˜ë½ì¥(ê¸ˆë¦¬ì¸ìƒ): ì˜µì…˜ í–‰ì‚¬ ì•ˆë¨ -> ì˜µì…˜ í”„ë¦¬ë¯¸ì—„ ì „ì²´ ì´ìµ

            // ì˜µì…˜ ë§¤ë„ í¬ì§€ì…˜ì˜ P&L (ì±„ê¶Œ ê°€ê²© ë³€ë™ì— ëŒ€í•œ)
            // ê°€ê²© ìƒìŠ¹ì‹œ: -(ìƒìŠ¹ë¶„) ë§Œí¼ ì†ì‹¤ì´ ë‚˜ì„œ ì±„ê¶Œ ì´ìµì„ ìƒì‡„í•¨ (ë‹¨, í”„ë¦¬ë¯¸ì—„ì€ ë°›ìŒ)
            // ê°€ê²© í•˜ë½ì‹œ: 0 (í–‰ì‚¬ í¬ê¸°), í”„ë¦¬ë¯¸ì—„ì€ ê·¸ëŒ€ë¡œ ì´ìµ

            let optionPayoffFromPrice = 0;
            if (priceChange > 0) {
                // ì±„ê¶Œ ê°€ê²©ì´ ì˜¬ëì„ ë•Œ (ê¸ˆë¦¬ ì¸í•˜), ì½œì˜µì…˜ ë§¤ë„ìëŠ” ê°€ê²© ìƒìŠ¹ë¶„ì„ ì†í•´ë´„(ìƒëŒ€ë°©ì—ê²Œ ì¤˜ì•¼í•¨)
                optionPayoffFromPrice = -priceChange;
            } else {
                // ì±„ê¶Œ ê°€ê²©ì´ ë–¨ì–´ì¡Œì„ ë•Œ, ì˜µì…˜ì€ ì†Œë©¸. ì¶”ê°€ ì†ìµ ì—†ìŒ.
                optionPayoffFromPrice = 0;
            }

            // ì „ëµ ìˆ˜ìµë¥  ê³„ì‚°
            // (ë¹„ì¤‘ * ì»¤ë²„ë“œì½œ ìˆ˜ìµ) + ((1-ë¹„ì¤‘) * ê·¸ëƒ¥ ì±„ê¶Œ ìˆ˜ìµ)
            // ì»¤ë²„ë“œì½œ ìˆ˜ìµ = ì±„ê¶Œê°€ê²©ë³€ë™ + ì±„ê¶Œì´ì + ì˜µì…˜í”„ë¦¬ë¯¸ì—„ + ì˜µì…˜ê°€ê²©ì†ìµ

            const coveredCallPartReturn = priceChange + BOND_COUPON + annualPremium + optionPayoffFromPrice;
            const pureBondPartReturn = rawBondReturn;

            const weightedReturn = (ccRatio * coveredCallPartReturn) + ((1 - ccRatio) * pureBondPartReturn);

            bondOnlyData.push(rawBondReturn);
            strategyData.push(weightedReturn);
        }

        return { labels, bondOnlyData, strategyData };
    }

    // --- ì°¨íŠ¸ ê·¸ë¦¬ê¸° ---
    function updateChart() {
        const ccRatio = parseFloat(ccSlider.value) / 100;
        const premium = parseFloat(premiumSlider.value);

        ccDisplay.innerText = ccSlider.value;
        premiumDisplay.innerText = premiumSlider.value;

        const data = calculateData(ccRatio, premium);

        if (myChart) myChart.destroy();

        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.labels,
                datasets: [
                    {
                        label: 'ë‚˜ì˜ ì „ëµ (Adjusted)',
                        data: data.strategyData,
                        borderColor: '#3b82f6', // Blue
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: false
                    },
                    {
                        label: 'ì±„ê¶Œ 100% ë³´ìœ  (Benchmark)',
                        data: data.bondOnlyData,
                        borderColor: '#ef4444', // Red
                        borderWidth: 2,
                        borderDash: [5, 5], // ì ì„ 
                        tension: 0.4,
                        pointRadius: 0
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                plugins: {
                    legend: { position: 'top' },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + context.parsed.y.toFixed(2) + '%';
                            }
                        }
                    },
                    annotation: {
                        annotations: {
                            line1: {
                                type: 'line',
                                yMin: 0,
                                yMax: 0,
                                borderColor: 'black',
                                borderWidth: 1,
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'ê¸ˆë¦¬ ë³€í™” (%p)' },
                        grid: { display: false }
                    },
                    y: {
                        title: { display: true, text: 'ì´ ìˆ˜ìµë¥  (%)' },
                        grid: { color: '#e2e8f0' }
                    }
                }
            }
        });

        updateAnalysis(ccRatio, premium);
    }

    function updateAnalysis(ccRatio, premium) {
        let text = "";
        if (ccRatio === 0) {
            text = "í˜„ì¬ <b>ìˆœìˆ˜ ì±„ê¶Œí˜•(Buy & Hold)</b> í¬íŠ¸í´ë¦¬ì˜¤ì…ë‹ˆë‹¤.<br>ê¸ˆë¦¬ í•˜ë½ ì‹œ ì‹œì„¸ ì°¨ìµì„ 100% ëˆ„ë¦´ ìˆ˜ ìˆì§€ë§Œ, ê¸ˆë¦¬ ìƒìŠ¹ ì‹œ ë°©ì–´ë§‰ì´ ì „í˜€ ì—†ì–´ ì†ì‹¤ì´ í½ë‹ˆë‹¤.";
        } else if (ccRatio >= 0.8) {
            text = `í˜„ì¬ <b>ê³ ë°°ë‹¹/ë°©ì–´í˜•(High Income)</b> í¬íŠ¸í´ë¦¬ì˜¤ì…ë‹ˆë‹¤.<br>ì—° ${premium}% ìˆ˜ì¤€ì˜ ì˜µì…˜ í”„ë¦¬ë¯¸ì—„ ë•ë¶„ì— ê¸ˆë¦¬ê°€ ì•½ê°„ ì˜¤ë¥´ê±°ë‚˜ íš¡ë³´í•´ë„ ìˆ˜ìµì„ ëƒ…ë‹ˆë‹¤.<br>í•˜ì§€ë§Œ <span class="highlight-red">ê¸ˆë¦¬ê°€ ëŒ€í­ í•˜ë½(ì±„ê¶Œ ê¸‰ë“±)í•  ë•Œ ìƒìŠ¹ë¶„ì´ ì œí•œ(Capped)</span>ë˜ì–´ ì‹œì¥ ìˆ˜ìµë¥ ì„ ë”°ë¼ê°€ì§€ ëª»í•©ë‹ˆë‹¤.`;
        } else {
            text = `í˜„ì¬ <b>í˜¼í•©í˜•(Balanced)</b> í¬íŠ¸í´ë¦¬ì˜¤ì…ë‹ˆë‹¤.<br>ë³´ìœ  ë¬¼ëŸ‰ì˜ ${(ccRatio*100).toFixed(0)}%ë§Œ ì˜µì…˜ì„ ë§¤ë„í•˜ì—¬, <span class="highlight-blue">í•˜ë½ì¥ì—ì„œì˜ ì¿ ì…˜ íš¨ê³¼</span>ì™€ <span class="highlight-red">ìƒìŠ¹ì¥ì—ì„œì˜ ì‹œì„¸ ì°¨ìµ</span>ì„ ì ì ˆíˆ íƒ€í˜‘í–ˆìŠµë‹ˆë‹¤.`;
        }
        analysisText.innerHTML = text;
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    ccSlider.addEventListener('input', updateChart);
    premiumSlider.addEventListener('input', updateChart);

    // ì´ˆê¸° ì‹¤í–‰
    updateChart();
</script>

</body>
</html>