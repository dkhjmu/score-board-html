<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹œê°„ ê²½ê³¼ì— ë”°ë¥¸ ì±„ê¶Œ vs ì»¤ë²„ë“œì½œ ìˆ˜ìµë¥  ë¹„êµ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --primary: #0f172a;
            --bond-color: #ef4444; /* Red */
            --cc-color: #3b82f6;   /* Blue */
        }
        body {
            font-family: 'Pretendard', -apple-system, sans-serif;
            background-color: var(--bg-color);
            padding: 20px;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            max-width: 1000px;
            width: 100%;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }
        h1 { text-align: center; margin-top: 0; margin-bottom: 10px; }
        .desc { text-align: center; color: #64748b; font-size: 0.95rem; margin-bottom: 30px; }

        /* ì»¨íŠ¸ë¡¤ëŸ¬ ì˜ì—­ */
        .control-panel {
            background: #f1f5f9;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }
        .slider-label {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 10px;
            display: block;
        }
        .rate-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            margin: 10px 0;
        }
        input[type=range] {
            width: 100%;
            max-width: 600px;
            margin: 10px 0;
            cursor: pointer;
        }

        /* ì°¨íŠ¸ ì˜ì—­ */
        .chart-wrapper {
            position: relative;
            height: 450px;
            width: 100%;
        }

        /* ê²°ê³¼ ìš”ì•½ ë°•ìŠ¤ */
        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .result-card {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        .card-bond { background: #fef2f2; border: 1px solid #fecaca; }
        .card-cc { background: #eff6ff; border: 1px solid #bfdbfe; }

        .res-title { font-size: 0.9rem; font-weight: 600; margin-bottom: 5px; }
        .res-val { font-size: 1.5rem; font-weight: 800; }

        .scenario-text {
            margin-top: 20px;
            padding: 15px;
            background: #fffbeb; /* Yellowish */
            border-left: 4px solid #f59e0b;
            font-size: 0.95rem;
            line-height: 1.5;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>â³ 12ê°œì›” ìˆ˜ìµë¥  ì‹œë®¬ë ˆì´ì…˜</h1>
    <p class="desc">
        "í–¥í›„ 1ë…„ê°„ ê¸ˆë¦¬ê°€ ì„œì„œíˆ ë³€í•œë‹¤ê³  ê°€ì •í•  ë•Œ, ë‚˜ì˜ ê³„ì¢ŒëŠ” ë§¤ì›” ì–´ë–»ê²Œ ë³€í• ê¹Œ?"<br>
        (Xì¶•: ì‹œê°„ / Yì¶•: ëˆ„ì  ìˆ˜ìµë¥ )
    </p>

    <div class="control-panel">
        <label class="slider-label">í–¥í›„ 1ë…„ê°„ ì˜ˆìƒ ê¸ˆë¦¬ ë³€í™”í­</label>
        <div class="rate-value" id="rateDisplay">0.00%</div>
        <input type="range" id="rateSlider" min="-2.0" max="2.0" step="0.1" value="0">
        <div style="display:flex; justify-content:space-between; max-width:600px; margin:0 auto; color:#666; font-size:0.8rem;">
            <span>ğŸ“‰ -2.0% (ê¸ˆë¦¬ í­ë½/ì±„ê¶Œ ê¸‰ë“±)</span>
            <span>ë³´í•© (íš¡ë³´)</span>
            <span>ğŸ“ˆ +2.0% (ê¸ˆë¦¬ ê¸‰ë“±/ì±„ê¶Œ í­ë½)</span>
        </div>
    </div>

    <div class="chart-wrapper">
        <canvas id="timeChart"></canvas>
    </div>

    <div class="result-grid">
        <div class="result-card card-bond">
            <div class="res-title" style="color:var(--bond-color)">ğŸŸ¥ ì¼ë°˜ êµ­ì±„ (Buy & Hold)</div>
            <div class="res-val" id="resBond" style="color:var(--bond-color)">0.0%</div>
            <div style="font-size:0.8rem; color:#666;">ë³€ë™ì„± ê·¸ëŒ€ë¡œ ë…¸ì¶œ</div>
        </div>
        <div class="result-card card-cc">
            <div class="res-title" style="color:var(--cc-color)">ğŸŸ¦ ì»¤ë²„ë“œì½œ (Buy-Write)</div>
            <div class="res-val" id="resCC" style="color:var(--cc-color)">0.0%</div>
            <div style="font-size:0.8rem; color:#666;">ì›”ë°°ë‹¹ ì¬íˆ¬ì ê°€ì •</div>
        </div>
    </div>

    <div class="scenario-text" id="scenarioAnalysis">
    </div>
</div>

<script>
    const ctx = document.getElementById('timeChart').getContext('2d');
    const slider = document.getElementById('rateSlider');
    const rateDisplay = document.getElementById('rateDisplay');
    const resBond = document.getElementById('resBond');
    const resCC = document.getElementById('resCC');
    const scenarioAnalysis = document.getElementById('scenarioAnalysis');

    // --- ê¸ˆìœµ ìƒìˆ˜ ì„¤ì • ---
    const DURATION = 17;        // 30ë…„ë¬¼ ë“€ë ˆì´ì…˜ (ì•½ 17ë…„)
    const BOND_YIELD_YR = 4.0;  // ì±„ê¶Œ ì—° ì´ì (4%)
    const OPTION_PREMIUM_YR = 12.0; // ì»¤ë²„ë“œì½œ ì—° í”„ë¦¬ë¯¸ì—„ ìˆ˜ìµ (12% ê°€ì •)
    const MONTHS = 12;

    let chart;

    function calculateTimeSeries(targetRateChange) {
        // ì›”ë³„ë¡œ ìª¼ê°œì„œ ê³„ì‚°
        const monthlyRateChange = targetRateChange / MONTHS;

        let labels = [];
        let bondData = [];
        let ccData = [];

        let cumBondReturn = 0;
        let cumCCReturn = 0;

        for (let i = 0; i <= MONTHS; i++) {
            labels.push(i + "ê°œì›”");

            if (i === 0) {
                bondData.push(0);
                ccData.push(0);
                continue;
            }

            // 1. ì´ë²ˆ ë‹¬ ì±„ê¶Œ ê°€ê²© ë³€ë™ (Capital Gain/Loss)
            // ê¸ˆë¦¬ 1% ì˜¤ë¥´ë©´ ê°€ê²©ì€ Duration% ë§Œí¼ í•˜ë½
            const monthlyPriceChange = -(DURATION * monthlyRateChange);

            // 2. ì´ë²ˆ ë‹¬ ì±„ê¶Œ ì´ì (Coupon)
            const monthlyCoupon = BOND_YIELD_YR / 12;

            // 3. ìˆœìˆ˜ ì±„ê¶Œ ì´ ìˆ˜ìµ (ì´ë²ˆ ë‹¬)
            const bondMonthlyTotal = monthlyPriceChange + monthlyCoupon;

            // 4. ì»¤ë²„ë“œì½œ ìˆ˜ìµ (ì´ë²ˆ ë‹¬)
            const monthlyPremium = OPTION_PREMIUM_YR / 12;

            // * ì»¤ë²„ë“œì½œ ë¡œì§ (í•µì‹¬) *
            // ê°€ê²©ì´ ì˜¤ë¥´ë©´(ê¸ˆë¦¬í•˜ë½): ìƒìŠ¹ë¶„(monthlyPriceChange)ì„ í¬ê¸°í•´ì•¼ í•¨ (Cap)
            // ê°€ê²©ì´ ë‚´ë¦¬ë©´(ê¸ˆë¦¬ìƒìŠ¹): í•˜ë½ë¶„ ê·¸ëŒ€ë¡œ ë§ìŒ + ëŒ€ì‹  í”„ë¦¬ë¯¸ì—„ìœ¼ë¡œ ë°©ì–´

            // ATM(At The Money) ë§¤ë„ ê°€ì •: ì±„ê¶Œ ê°€ê²© ìƒìŠ¹ë¶„ì€ 0ìœ¼ë¡œ ì²˜ë¦¬ (ë‚´ê²ƒì´ ì•„ë‹˜)
            // ë‹¨, ì‹¤ì œ ETFëŠ” ì•½ê°„ OTMìœ¼ë¡œ íŒ”ê¸°ì— ìƒìŠ¹ë¶„ 20%ì •ë„ëŠ” ë¨¹ëŠ”ë‹¤ê³  ê°€ì •í•˜ê³  ë¡œì§ ì™„í™”
            // ë¡œì§: Min(ê°€ê²©ë³€ë™, 0.2 * ê°€ê²©ë³€ë™[ìƒìŠ¹ì‹œ]) + ì¿ í° + í”„ë¦¬ë¯¸ì—„

            let ccPricePart = 0;
            if (monthlyPriceChange > 0) {
                // ì±„ê¶Œê°€ê²© ìƒìŠ¹ ì‹œ: ìƒìŠ¹ë¶„ì˜ 20%ë§Œ ê°€ì§ (ë‚˜ë¨¸ì§€ëŠ” ì½œì˜µì…˜ ë§¤ìˆ˜ìê°€ ê°€ì ¸ê°)
                ccPricePart = monthlyPriceChange * 0.2;
            } else {
                // ì±„ê¶Œê°€ê²© í•˜ë½ ì‹œ: í•˜ë½ë¶„ 100% ë‹¤ ë§ìŒ
                ccPricePart = monthlyPriceChange;
            }

            const ccMonthlyTotal = ccPricePart + monthlyCoupon + monthlyPremium;

            // ëˆ„ì  (ë‹¨ë¦¬ í•©ì‚° ë°©ì‹ ì‹œê°í™”)
            cumBondReturn += bondMonthlyTotal;
            cumCCReturn += ccMonthlyTotal;

            bondData.push(parseFloat(cumBondReturn.toFixed(2)));
            ccData.push(parseFloat(cumCCReturn.toFixed(2)));
        }

        return { labels, bondData, ccData };
    }

    function updateSimulation() {
        const val = parseFloat(slider.value);
        const sign = val > 0 ? "+" : "";
        rateDisplay.innerText = `${sign}${val.toFixed(1)}%p`;
        rateDisplay.style.color = val > 0 ? "#ef4444" : (val < 0 ? "#3b82f6" : "#333"); // ê¸ˆë¦¬ ì˜¤ë¥´ë©´ ë¹¨ê°•(ìœ„í—˜), ë‚´ë¦¬ë©´ íŒŒë‘(í˜¸ì¬)

        const data = calculateTimeSeries(val);

        // ê²°ê³¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        const finalBond = data.bondData[MONTHS];
        const finalCC = data.ccData[MONTHS];
        resBond.innerText = (finalBond > 0 ? "+" : "") + finalBond + "%";
        resCC.innerText = (finalCC > 0 ? "+" : "") + finalCC + "%";

        // ì‹œë‚˜ë¦¬ì˜¤ í…ìŠ¤íŠ¸
        let analysis = "";
        if (val < -0.5) {
            analysis = `<b>ğŸš€ ê¸ˆë¦¬ ê¸‰ë½ (ì±„ê¶Œ ëŒ€ìƒìŠ¹ì¥)</b><br>ê¸ˆë¦¬ê°€ ë–¨ì–´ì ¸ ì±„ê¶Œ ê°€ê²©ì´ í­ë“±í•©ë‹ˆë‹¤. <br>ì¼ë°˜ ì±„ê¶Œ(ğŸŸ¥)ì€ ì‹œì„¸ ì°¨ìµì„ ì˜¨ì „íˆ ëˆ„ë¦¬ì§€ë§Œ, ì»¤ë²„ë“œì½œ(ğŸŸ¦)ì€ <b>ìƒìŠ¹ë¶„ì´ ë§‰í˜€ìˆì–´(Capped)</b> ìˆ˜ìµë¥  ê²©ì°¨ê°€ ë²Œì–´ì§‘ë‹ˆë‹¤. ì´ëŸ´ ë• ê·¸ëƒ¥ ì±„ê¶Œì„ ë“¤ê³  ìˆëŠ” ê²Œ ë‚«ìŠµë‹ˆë‹¤.`;
        } else if (val > 0.5) {
            analysis = `<b>ğŸ“‰ ê¸ˆë¦¬ ìƒìŠ¹ (ì±„ê¶Œ í•˜ë½ì¥)</b><br>ê¸ˆë¦¬ê°€ ì˜¬ë¼ ì±„ê¶Œ ê°€ê²©ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤.<br>ì¼ë°˜ ì±„ê¶Œ(ğŸŸ¥)ì€ ì†ì‹¤ì´ ì»¤ì§€ì§€ë§Œ, ì»¤ë²„ë“œì½œ(ğŸŸ¦)ì€ <b>ë§¤ë‹¬ ë“¤ì–´ì˜¤ëŠ” í”„ë¦¬ë¯¸ì—„(ì›”ì„¸)</b>ì´ ì†ì‹¤ì„ ìƒì‡„í•˜ì—¬ í›¨ì”¬ ì˜ ë²„íŒë‹ˆë‹¤. ë°©ì–´ë ¥ì´ ë¹›ì„ ë°œí•˜ëŠ” êµ¬ê°„ì…ë‹ˆë‹¤.`;
        } else {
            analysis = `<b>ğŸ¢ íš¡ë³´ì¥ (Goldilocks for CC)</b><br>ê¸ˆë¦¬ê°€ í° ë³€í™”ê°€ ì—†ìŠµë‹ˆë‹¤.<br>ì¼ë°˜ ì±„ê¶Œ(ğŸŸ¥)ì€ ì´ìë§Œ ì¡°ê¸ˆ ë°›ì§€ë§Œ, ì»¤ë²„ë“œì½œ(ğŸŸ¦)ì€ <b>ì´ì + ì˜µì…˜ í”„ë¦¬ë¯¸ì—„</b>ì´ ê¼¬ë°•ê¼¬ë°• ìŒ“ì—¬ ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ì••ë„ì ì¸ ìˆ˜ìµì„ ëƒ…ë‹ˆë‹¤. ì»¤ë²„ë“œì½œì´ ê°€ì¥ ìœ ë¦¬í•œ í™˜ê²½ì…ë‹ˆë‹¤.`;
        }
        scenarioAnalysis.innerHTML = analysis;

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        if (chart) chart.destroy();

        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.labels,
                datasets: [
                    {
                        label: 'ì»¤ë²„ë“œì½œ (TLTW)',
                        data: data.ccData,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.3
                    },
                    {
                        label: 'ì¼ë°˜ êµ­ì±„ (TLT)',
                        data: data.bondData,
                        borderColor: '#ef4444',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        tension: 0.3,
                        pointRadius: 2
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + context.parsed.y + '%';
                            }
                        }
                    },
                    legend: { position: 'top' },
                    annotation: {
                        annotations: {
                            line1: {
                                type: 'line',
                                yMin: 0,
                                yMax: 0,
                                borderColor: 'rgba(0,0,0,0.3)',
                                borderWidth: 1,
                            }
                        }
                    }
                },
                scales: {
                    x: { grid: { display: false } },
                    y: {
                        title: { display: true, text: 'ëˆ„ì  ìˆ˜ìµë¥  (%)' },
                        suggestedMin: -20,
                        suggestedMax: 20
                    }
                }
            }
        });
    }

    slider.addEventListener('input', updateSimulation);

    // ì´ˆê¸° ì‹¤í–‰
    updateSimulation();
</script>

</body>
</html>